format_version: 0.9.10
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  - PROJECT_TITLE: BitriseSampleWithYML
  - XCODE_PROJECT_PATH: ./${PROJECT_TITLE}.xcodeproj
  - XCODE_PROJECT_SCHEME: ${PROJECT_TITLE}
  - BITRISE_KEYCHAIN_PATH: $HOME/Library/Keychains/login.keychain
  - BITRISE_KEYCHAIN_PASSWORD: vagrant

workflows:

  _download_certs:
    steps:
    - git::https://github.com/bitrise-io/steps-certificate-and-profile-installer.git@master:
        description: |-
          This step will only be used in CI mode, on continuous integration
          servers / services (because of the `run_if` statement),
          but **NOT** when you run it on your own machine.
        run_if: .IsCI
        inputs:
        - keychain_path: $BITRISE_KEYCHAIN_PATH
        - keychain_password: $BITRISE_KEYCHAIN_PASSWORD

  test:
    steps:
    - new-xcode-test@0.9.1:
        inputs:
        - project_path: ${XCODE_PROJECT_PATH}
          opts:
            is_expand: yes
        - scheme: ${XCODE_PROJECT_SCHEME}
          opts:
            is_expand: yes
        - simulator_device: iPhone 6
        - simulator_os_version: latest

  analyze:
    before_run:
    - _download_certs
    steps:
    - script:
        inputs:
        - content: xcodebuild -project "${XCODE_PROJECT_PATH}" -scheme "${XCODE_PROJECT_SCHEME}" analyze

  archive:
    before_run:
    - test
    - _download_certs
    steps:
    - new-xcode-archive:
        title: Step Test
        inputs:
        - project_path: ${XCODE_PROJECT_PATH}
        - scheme: ${XCODE_PROJECT_SCHEME}
